---
- name: Stopping all kubelet services
  hosts: k8s_workers
  become: yes
  tasks:
    - name: Check listening ports for etcd and kube
      command: netstat -tulpn | grep -E 'etcd|kube' | awk -F/ '{ print $2 }' | uniq
      register: kube_services_items
      failed_when: kube_services_items.rc != 0

    - name: Stop kube-services-items on worker nodes
      systemd:
        name: "{{ item }}"
        state: stopped
      with_items: kube_services_items.stdout_lines






